# ========================================
# AXION BACKEND - PRODUCTION ENVIRONMENT
# ========================================
# Copy this file to .env.production and fill in the values
# Never commit .env.production to git!

# ========================================
# DEPLOYMENT MODE
# ========================================
# Choose deployment architecture:
# - 'embedded': MCP runs inside NestJS (single Railway service)
# - 'separate': MCP runs as separate Railway service (recommended)
DEPLOYMENT_MODE=separate

# ========================================
# SERVER CONFIGURATION
# ========================================
PORT=3001
NODE_ENV=production
APP_URL=https://axion-backend.railway.app

# ========================================
# OPENROUTER API
# ========================================
# Get your API key from: https://openrouter.ai/keys
OPENROUTER_API_KEY=sk-or-v1-your-production-key-here
OPENROUTER_MODEL=x-ai/grok-4.1-fast

# Optional: Set custom timeout and retry settings
# OPENROUTER_TIMEOUT_MS=30000
# OPENROUTER_MAX_RETRIES=3

# ========================================
# MCP SERVER CONFIGURATION
# ========================================

# --- OPTION A: SEPARATE DEPLOYMENT (Recommended) ---
# Use when DEPLOYMENT_MODE=separate
MCP_MODE=remote
MCP_REMOTE_URL=https://axion-mcp.railway.app
# Or use Railway internal networking for better performance:
# MCP_REMOTE_URL=http://axion-mcp.railway.internal:3000
MCP_API_KEY=your-production-mcp-api-key

# --- OPTION B: EMBEDDED DEPLOYMENT ---
# Use when DEPLOYMENT_MODE=embedded
# MCP_MODE=local
# MCP_SERVER_PATH=dist/mcp/mcp-server.js

# ========================================
# DATABASE (Neon DB)
# ========================================
# Get connection string from: https://console.neon.tech
# Format: postgresql://user:password@host/dbname?sslmode=require
DATABASE_URL=postgresql://user:password@ep-xxx.us-east-1.aws.neon.tech/dbname?sslmode=require&channel_binding=require

# Connection pool settings (optional)
# DATABASE_POOL_SIZE=10
# DATABASE_STATEMENT_TIMEOUT=60000

# Data retention period (days)
DATA_RETENTION_DAYS=90

# ========================================
# REDIS CACHE (Upstash)
# ========================================
# Get credentials from: https://console.upstash.com
# Optional but HIGHLY recommended for production
# Falls back to in-memory cache if not provided
UPSTASH_REDIS_URL=https://your-production-redis.upstash.io
UPSTASH_REDIS_TOKEN=your-production-redis-token

# Cache TTL settings (seconds)
# CACHE_TTL_AI_RESPONSES=3600
# CACHE_TTL_TOOL_RESULTS=1800
# CACHE_TTL_ANALYTICS=300

# ========================================
# AUTHENTICATION & SECURITY
# ========================================

# API Keys (comma-separated)
# Generate secure keys using: openssl rand -hex 32
API_KEYS=prod-key-1-xxxxxxxxxxxxx,prod-key-2-yyyyyyyyyyyyy

# CORS Origins (comma-separated)
# Add your frontend domain(s)
ALLOWED_ORIGINS=https://yourfrontend.com,https://app.yourfrontend.com

# Rate limiting (requests per minute)
# RATE_LIMIT_ANALYZE=10
# RATE_LIMIT_GLOBAL=100

# ========================================
# MONITORING & ERROR TRACKING
# ========================================

# Sentry DSN
# Get from: https://sentry.io/settings/projects/
SENTRY_DSN=https://xxxxx@xxxxx.ingest.sentry.io/xxxxx
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_DEV_ENABLED=false

# Log level: 'error' | 'warn' | 'info' | 'debug'
LOG_LEVEL=info

# ========================================
# TEAM ACCESS (Optional)
# ========================================
# Shared MCP endpoint for team member connections
# Team members can connect their local NestJS to this MCP
TEAM_MCP_URL=https://axion-mcp.railway.app
TEAM_MCP_API_KEY=team-shared-key-xxxxxxxxxxxxx

# ========================================
# RAILWAY PLATFORM VARIABLES
# ========================================
# These are automatically provided by Railway:
# - RAILWAY_ENVIRONMENT=production
# - RAILWAY_SERVICE_NAME=axion-backend
# - RAILWAY_STATIC_URL=axion-backend.railway.app
# - RAILWAY_PRIVATE_DOMAIN=axion-backend.railway.internal

# ========================================
# FEATURE FLAGS (Optional)
# ========================================
# ENABLE_COMPRESSION=true
# ENABLE_HELMET_SECURITY=true
# ENABLE_CACHE_CONTROL_HEADERS=true
# ENABLE_REQUEST_LOGGING=true

# ========================================
# PERFORMANCE TUNING (Optional)
# ========================================
# NODE_OPTIONS=--max-old-space-size=512
# WORKER_THREADS=2
